### 一、高度警惕空指针和野指针的袭击
#### 1.空指针
> 没有存储任何**内存地址**的指针称为**空指针(NULL指针)**。空指针就是被赋值为零的指针，在没有被具体初始化之前，其值为零。即，一个指针变量分配一个NULL指针的情况下，没有确切的地址被分配。

```objc
Student *stu1 = NULL;
Student *stu2 = nil;
```

#### 2.野指针
> 野指针不是NULL指针，而是**指向“垃圾”内存**（不可用内存）的指针。

```objc
Student *stu = [[Student alloc] init];
[stu setAge: 10];
[stu release];
[stu setAge:10]; //此时stu对象被销毁了，它所占用的内存为垃圾内存。因此，再去访问它的话，会导致crash。
```
**为了避免野指针的出现，在销毁对象后，应该及时将对象设置为`nil`。**

### 二、在64位环境下尽可能使用标记指针
#### 1.指针对齐
> 为了加快内存CPU的访问速度，程序都使用了**指针地址对齐**概念。指针地址对齐指的是**在分配堆中的内存往往采用偶数倍或2为指数的内存地址作为地址边界**。在iOS中，**系统是以16个字节为内存分配边界的**。或者说iOS的指针地址对齐是以16个字节为对齐边界的。进一步说，**iOS中分配的内存地址最后4位永远都是零**。

#### 2.标记（Tagged）指针
> 由于指针地址对齐概念和64位超大地址的出现，指针地址仅仅作为内存的地址是比较浪费的，故此，可以在指针地址中保存或附加更多的信息。这就引入了**标记（Tagged）指针**概念。**标记指针指的是指针中包含特殊属性或信息的指针**。

#### 3.标记指针对`NSNumber`的优化
> `NSNumber`对于较小的数会将值直接保存在指针中，而无需在堆中分配内存，以便提高内存访问速度和整体运算速度。而对于超过标记范围的数，则会在堆中分配内存以存储值。**通常可以使用内存对齐的概念来区分是否将值存储在指针中，对于指针的后4位都为零的，表示存在在堆中**。

```objc
NSNumber *num1 = @1;
NSNumber *num2 = @2;
NSLog("num1 pointer is %p", num1);
NSLog("num2 pointer is %p", num2);
===
num1 pointer is 0xb000000000000012
num2 pointer is 0xb000000000000022
```
num1和num2的前4位都为0xb，后4位为0x2(指针的tag)，中间为实际的取值。

```objc
NSNumber *bigNum = @(0x1234567890ABCDEF);
NSLog("big num pointer is %p", bigNum);
====
big num pointer is 0x1094026a0
```
可以看出bigNum的指针后4位都为0，说明它是堆中分配的对象。

#### 4.标记指针对`isa`指针的优化
> 在64位环境下，`isa`也是64位，**实际作为指针部分只用到其中的32位，剩余的19位将用来保存对象的引用计数，这样对引用计数的操作只需要原子的修改这个指针即可**。如果引用计数超过19位，才会引用计数保存到外部表，但这种情况往往很少出现，因此效率将大幅度提高。

```objc
@interface NSObject <NSObject> {
    Class isa;
}
```

### 三、常量字符
> 由于常量会占用一块特殊的代码段，加载到内存时会映射到一块常量存储区，以加快访问速度。编译器会在编译时将相同的内容的字符串指向同一个区域，而不是再开辟出一块额外的空间。

### 四、集合中的快速枚举
- 集合类中`NSArray`、`NSDictionary`等实现了`NSFastEnumeration`协议，则可以使用快速枚举的方式。若自定义集合需要实现快速枚举，则需要自己实现`NSFastEnumeration`协议。具体可以参照[这里](https://www.jianshu.com/p/2ec49d525871)。

- 在快速枚举集合中，不能变异集合，即使集合是可变的。如果在循环内，尝试添加或删除集合的对象，则会生成运行时异常。

### 五、明智而审慎地使用`BOOL`类型
> 在Objective-C中被定义为`unsigned char，这意味着它不仅仅只有`YES(1)`和`NO(0)`两个值。因此，不要直接把整型强制转换为`BOOL`类型，且不要将`BOOL`类型变量直接和`YES`或`NO`直接做比较。

```objc
// AVOID
BOOL great = [foo isGreat];
if (great == YES) {
    ....
}
// GOOD
if (great) {
    ....
}
```

